# ------------------------------------------------------
# pnpm repository policy
# ------------------------------------------------------
# This file defines strict dependency and execution rules
# for this repository.
#
# Goals:
# - Reproducible installs
# - Explicit dependency graph
# - No hidden execution chains
# - Low cognitive overhead for developers
# - Secure-by-default without breaking DX
#
# This file MUST be committed to the repository.
# ------------------------------------------------------

# ------------------------------------------------------
# Lockfile enforcement
# ------------------------------------------------------
# Always require pnpm-lock.yaml to match package.json.
# Installation fails if they are out of sync.
#
# This guarantees deterministic installs across machines,
# CI, and operating systems.
prefer-frozen-lockfile=true

# ------------------------------------------------------
# node_modules layout
# ------------------------------------------------------
# Use isolated node_modules layout.
#
# Benefits:
# - Prevents implicit/hidden dependencies
# - Eliminates accidental hoisting
# - Makes dependency graph explicit
# - Avoids "works on my machine" scenarios
#
# This is the recommended mode for applications.
node-linker=isolated

# ------------------------------------------------------
# Hoisting behavior
# ------------------------------------------------------
# Explicitly disable hoisting.
#
# If a dependency is required, it must be declared.
# Prevents relying on transitive dependencies.
shamefully-hoist=false

# ------------------------------------------------------
# Workspace behavior
# ------------------------------------------------------
# Prefer local workspace packages when available.
# Safe to keep even for single-package repositories.
link-workspace-packages=true

# ------------------------------------------------------
# Script execution policy
# ------------------------------------------------------
# DO NOT disable lifecycle scripts globally.
#
# We intentionally allow install/prepare/postinstall scripts
# so legitimate tooling (e.g., husky) works automatically.
#
# Instead, we disable automatic execution of preX/postX
# wrapper scripts to prevent invisible script chaining.
#
# This blocks:
#   prebuild -> build -> postbuild (implicit chaining)
#
# While still allowing:
#   pnpm run build
#   pnpm run prebuild (explicit execution)
#   lifecycle scripts like prepare or postinstall
#
# This provides a strong security baseline
# without adding cognitive overhead.
enable-pre-post-scripts=false
